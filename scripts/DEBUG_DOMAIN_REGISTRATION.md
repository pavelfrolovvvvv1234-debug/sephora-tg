# Отладка регистрации доменов

## Проблема
Домен показывается как доступный, но регистрация падает с ошибкой.

## Как проверить что не так

### 1. Запусти тестовый скрипт

```bash
npm run test-amper-register test123.com
```

Или с конкретным доменом:
```bash
npm run test-amper-register idufigoudofgdf.com
```

Скрипт покажет:
- Что возвращает Amper API при проверке доступности
- Что возвращает Amper API при попытке регистрации
- Детали ошибок (статус код, тело ответа)

### 2. Проверь логи бота

После попытки регистрации в боте, проверь логи. Ты увидишь записи с префиксом `[Amper]`:
- `[Amper] Checking availability` - что отправляется на проверку
- `[Amper] Check response` - что вернул API
- `[Amper] Registering domain` - что отправляется на регистрацию
- `[Amper] Register response` - что вернул API при регистрации
- `[AmperDomainService] Registration failed` - детали ошибки

### 3. Возможные проблемы

**Проблема 1: Amper API возвращает 400 "Invalid domain format"**
- **Причина**: API не принимает формат домена
- **Решение**: Нужно уточнить у поддержки Amper правильный формат

**Проблема 2: Amper API возвращает success: false без domainId**
- **Причина**: Регистратор отклонил регистрацию (домен занят, недостаточно средств и т.д.)
- **Решение**: Проверь баланс в кабинете Amper, проверь что домен действительно свободен

**Проблема 3: Amper API возвращает ошибку сети/timeout**
- **Причина**: Проблемы с подключением или API недоступен
- **Решение**: Проверь интернет, проверь что `AMPER_API_BASE_URL` правильный

**Проблема 4: Amper API возвращает 401**
- **Причина**: Неверный токен
- **Решение**: Проверь `AMPER_API_TOKEN` в `.env`

### 4. Что делать дальше

1. Запусти тестовый скрипт и посмотри что он выводит
2. Скопируй вывод скрипта и логи бота
3. Отправь в поддержку Amper с вопросом: "Почему API возвращает такую ошибку?"
4. Или покажи мне вывод - я помогу разобраться

### 5. Временное решение

Если Amper API не работает, можно:
- Отключить автоматическую регистрацию через Amper
- Использовать ручную регистрацию через заявки (`/domainrequests`)
- Или найти другого регистратора с рабочим API
